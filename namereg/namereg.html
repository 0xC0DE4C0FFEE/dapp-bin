<!DOCTYPE html>
<html>
  <head>
    <title>NameReg</title>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <style>
body {
	font-family: Gentium, Georgia, serif
}
h1, h2 {
	font-family: Trebuchet MS, sans
}
h1 { 
	font-size: 16pt
}
h2 { 
	font-size: 13pt
}
div {
	margin-left: 8pt;
}
img {
	margin: 4pt;
	padding: 6pt;
}
    </style>
  </head>
  <body>
    <h1>NameReg</h1>
	<h2>Your Name</h2>
	<div id="yourname"></div>
    <h2>Lookup</h2>
    <div>
      <label for="name">Name: </label>
      <input id="name" type="text" value="" onkeyup="lookupName()">
      <label for="addr">Address: </label>
      <input id="addr" type="text" value="" onkeyup="lookupAddr()">
    </div>
    <h2>Register Name</h2>
    <div>
      <label for="name">Name: </label>
      <input id="regname" type="text" value="">
      <button onclick="regName()">Register</button>
      <button onclick="unregName()">Unregister</button>
    </div>
    <!--h2>Register Domain</h2>
    <div>
      <label for="name">IP/Web domain: </label>
      <input id="ip" type="text" value="">
      <label for="name">Ethereum Domain: </label>
      <input id="domain" type="text" value="">
      <span>.eth</span>
      <button onclick="regDomain()">Register</button>
    </div-->

   <script>
var abiConfig = [{"constant":false,"inputs":[],"name":"kill","outputs":[]},{"constant":true,"inputs":[{"name":"service","type":"uint256"}],"name":"lookup","outputs":[{"name":"a","type":"address"}]},{"constant":false,"inputs":[{"name":"id","type":"uint256"},{"name":"service","type":"address"}],"name":"register","outputs":[]},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"unregister","outputs":[]}];
var abiNameReg = [{"constant":true,"inputs":[{"name":"name","type":"string32"}],"name":"addressOf","outputs":[{"name":"addr","type":"address"}]},{"constant":false,"inputs":[],"name":"kill","outputs":[]},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"nameOf","outputs":[{"name":"name","type":"string32"}]},{"constant":false,"inputs":[{"name":"name","type":"string32"}],"name":"register","outputs":[]},{"constant":false,"inputs":[],"name":"unregister","outputs":[]}];
var addrConfig = "0x661005d2720d855f1d9976f88bb10c1a3398c77f";
var addrNameReg;
var NameReg;
var w;

regName = function()
{
	var name = document.getElementById("regname").value;
	if (name != "")
			NameReg.register(name).transact();
}
unregName = function()
{
	NameReg.unregister().transact();
}
lookupName = function()
{
	NameReg.addressOf(document.getElementById("name").value).call().then(function(n) { document.getElementById("addr").value = n; });
}
lookupAddr = function()
{
	NameReg.nameOf("0x" + document.getElementById("addr").value).call().then(function(n) { document.getElementById("name").value = n; });
}
web3.contract(addrConfig, abiConfig).lookup(1).call().then(function(n){
	addrNameReg = n[0];
	NameReg = web3.contract(addrNameReg, abiNameReg);
	web3.eth.accounts.then(function(as) { 
		w = web3.eth.watch({address: addrNameReg, topics: as[0]});
		w.changed(function(d) {
			NameReg.nameOf(as[0]).call().then(function(n) { document.getElementById("yourname").innerHTML = n; });
		});
	});
});

    </script>
    <span id="test"></span>
  </body>
</html>
