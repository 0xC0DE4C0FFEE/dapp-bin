<html>
<head>
<title>Frontier Registry</title>
</head>
<body>
<div>
From: <input id="from" value="XE930WWR03ZUUB03QR0NPY442HQYHLHEG3"/>
</div>
<div id="nameaction">
Name: <input id="name" value=""/>
<div id="unreserved">
<button onClick="reserve()">Reserve</button>
</div>
<div id="owned">
<div>You own this name with account: <span id="ourowner"></span></div>
<div>Address: <input id="address"/><button id="setaddress">Set</button><button id="setprimary">Set Canonical</button></div>
<div>Subregistrar: <input id="sub"/><button id="setsub">Set</button></div>
<div>Content: <input id="content"/><button id="setcontent">Set</button></div>
<div>Transfer: <input id="transferto"/><span id="transfer"></span></div>
</div>
<div id="reserved">
Name is already reserved by <span id="reservedowner"></span>.
</div>
<div id="short">
Name too short to reserve.
</div>
</div>
<div id="log">
</div>
<script>

var FixedFeeRegistrar = web3.eth.contract([{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"name","outputs":[{"name":"o_name","type":"string"}],"type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"string"},{"name":"_newOwner","type":"address"}],"name":"setOwner","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"string"},{"name":"_a","type":"address"}],"name":"setAddr","outputs":[],"type":"function"},{"constant":true,"inputs":[{"name":"_name","type":"string"}],"name":"addr","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[{"name":"_name","type":"string"}],"name":"subRegistrar","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"string"}],"name":"reserve","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"string"},{"name":"_refund","type":"address"}],"name":"disown","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"string"}],"name":"setName","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"string"},{"name":"_registrar","type":"address"}],"name":"setSubRegistrar","outputs":[],"type":"function"},{"constant":true,"inputs":[{"name":"_name","type":"string"}],"name":"content","outputs":[{"name":"","type":"bytes32"}],"type":"function"},{"constant":true,"inputs":[{"name":"_name","type":"string"}],"name":"owner","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[{"name":"_name","type":"string"}],"name":"record","outputs":[{"name":"o_addr","type":"address"},{"name":"o_subRegistrar","type":"address"},{"name":"o_content","type":"bytes32"},{"name":"o_owner","type":"address"}],"type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"string"},{"name":"_content","type":"bytes32"}],"name":"setContent","outputs":[],"type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"name":"name","type":"string"}],"name":"Changed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"addr","type":"address"},{"indexed":true,"name":"name","type":"string"}],"name":"ReverseChanged","type":"event"}]);
var theReg = FixedFeeRegistrar.at("0x1498992871c4d59667dd62a87e1ceeaccb08a58d");
var price = 5000000000000000000;
var $ = function(_s) { return document.getElementById(_s); }
var $log = function(_s) { $('log').innerHTML += "<div>" + _s + "</div>"; }

function reserve() {
	theReg.reserve.sendTransaction($('name').value, {from: $('from').value, value: price});
}

function updatenameaction() {
	var n = $('name').value;
	var reserved = false;
	var ours = false;
	var short = n.length < 9;
	var owner;
	if (!short)
	{
		owner = theReg.owner(n);
		reserved = owner != "0x";
		if (reserved)
			for (var i in web3.eth.accounts)
				if (i == owner)
					ours = true;
	}
	$('short').style.display = short ? null : 'none';
	$('unreserved').style.display = (!short && !reserved) ? null : 'none';
	$('reserved').style.display = (!short && reserved && !ours) ? null : 'none';
	$('owned').style.display = ours ? null : 'none';
	$('ourowner').innerHTML = owner;	
	$('reservedowner').innerHTML = owner;
}

$('name').onkeyup = function(e) { /*if (e.keyCode == 46 || e.keyCode == 8)*/ updatenameaction(); };

updatenameaction();
/*
theWallet.ConfirmationNeeded(function(error, result) {
	console.log("CONFIRMATION NEEDED:" + JSON.stringify(result));
	last = result.args.operation;
	h = '<button id="confirmPending" onClick="' + "theWallet.confirm.sendTransaction('" + result.args.operation + "', {from: spruce(document.getElementById('from').value)})" + '">Confirm ' + result.args.operation + '</button>';
	document.getElementById("pending").innerHTML = h;
});

theWallet.MultiTransact(function(error, result) {
	console.log("TXDONE:" + JSON.stringify(result));
	if (last == result.args.operation)
	{
		document.getElementById("pending").innerHTML = "";
		last = null;
	}
});

theWallet.Confirmation(function(error, result) {
	console.log("CONFIRM:" + JSON.stringify(result));
	if (last == result.args.operation)
	{
		h = '<div>by ' + result.args.owner + "</div>";
		document.getElementById("pending").innerHTML += h;
		if (spruce(result.args.owner) == spruce(document.getElementById("from").value))
			document.getElementById("confirmPending").disabled += true;
	}
});
*/
</script>
</body>
</html>

